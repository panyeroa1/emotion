<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <title>Cartesia Ink STT - Real-time Transcription</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        ink: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            900: '#0c4a6e',
                            950: '#082f49',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'wave': 'wave 1.5s infinite',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        wave: {
                            '0%, 100%': { transform: 'scaleY(1)' },
                            '50%': { transform: 'scaleY(2)' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            -webkit-backdrop-filter: blur(16px);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .transcript-line {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .transcript-line.interim {
            opacity: 0.6;
            border-left-color: #0ea5e9;
            font-style: italic;
        }

        .transcript-line.final {
            opacity: 1;
            border-left-color: #10b981;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .audio-bar {
            display: inline-block;
            width: 3px;
            background: #0ea5e9;
            margin: 0 1px;
            border-radius: 2px;
            animation: wave 0.5s ease-in-out infinite;
        }

        .audio-bar:nth-child(2) {
            animation-delay: 0.1s;
            height: 20px;
        }

        .audio-bar:nth-child(3) {
            animation-delay: 0.2s;
            height: 30px;
        }

        .audio-bar:nth-child(4) {
            animation-delay: 0.3s;
            height: 25px;
        }

        .audio-bar:nth-child(5) {
            animation-delay: 0.4s;
            height: 35px;
        }

        .recording-indicator {
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            animation: recording-pulse 2s infinite;
        }

        @keyframes recording-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
    <base target="_blank">
</head>

<body class="text-gray-100 antialiased overflow-x-hidden">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass-panel border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-wave-square text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg tracking-tight">Cartesia Ink STT</h1>
                    <p class="text-xs text-gray-400">Real-time Speech-to-Text</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div id="connection-status"
                    class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-gray-800/50 border border-gray-700 text-xs font-medium text-gray-400">
                    <span class="w-2 h-2 rounded-full bg-gray-500" id="status-dot"></span>
                    <span id="status-text">Disconnected</span>
                </div>
                <a href="https://docs.cartesia.ai" target="_blank" rel="noopener"
                    class="text-gray-400 hover:text-white transition-colors" title="Cartesia Documentation">
                    <i class="fa-solid fa-circle-info text-lg"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-8 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">

        <!-- Configuration Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">

            <!-- API Configuration -->
            <div class="glass-panel rounded-2xl p-6 space-y-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-semibold text-lg flex items-center gap-2">
                        <i class="fa-solid fa-key text-cyan-400"></i>
                        Configuration
                    </h2>
                </div>

                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1.5">API Key</label>
                        <input type="password" id="api-key" placeholder="sk_car_..."
                            class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all placeholder-gray-600 font-mono">
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="model-select"
                                class="block text-sm font-medium text-gray-400 mb-1.5">Model</label>
                            <select id="model-select" title="Select STT Model"
                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500 text-gray-200">
                                <option value="ink-whisper">ink-whisper (Latest)</option>
                                <option value="ink-whisper-2025-06-04">ink-whisper-2025-06-04</option>
                            </select>
                        </div>
                        <div>
                            <label for="language-select"
                                class="block text-sm font-medium text-gray-400 mb-1.5">Language</label>
                            <select id="language-select" title="Select Transcription Language"
                                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:border-cyan-500 text-gray-200">
                                <option value="en">English</option>
                                <option value="zh">Chinese</option>
                                <option value="de">German</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="ru">Russian</option>
                                <option value="pt">Portuguese</option>
                                <option value="it">Italian</option>
                                <option value="nl">Dutch</option>
                                <option value="ar">Arabic</option>
                                <option value="hi">Hindi</option>
                                <option value="tr">Turkish</option>
                                <option value="pl">Polish</option>
                                <option value="sv">Swedish</option>
                                <option value="uk">Ukrainian</option>
                                <option value="he">Hebrew</option>
                                <option value="vi">Vietnamese</option>
                                <option value="id">Indonesian</option>
                                <option value="fi">Finnish</option>
                                <option value="el">Greek</option>
                                <option value="cs">Czech</option>
                                <option value="ro">Romanian</option>
                                <option value="da">Danish</option>
                                <option value="hu">Hungarian</option>
                                <option value="ta">Tamil</option>
                                <option value="no">Norwegian</option>
                                <option value="th">Thai</option>
                                <option value="ur">Urdu</option>
                                <option value="hr">Croatian</option>
                                <option value="bg">Bulgarian</option>
                                <option value="sk">Slovak</option>
                                <option value="yue">Cantonese</option>
                                <option value="af">Afrikaans</option>
                                <option value="sw">Swahili</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="glass-panel rounded-2xl p-6 lg:col-span-2 flex flex-col justify-between">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="font-semibold text-lg flex items-center gap-2">
                        <i class="fa-solid fa-chart-line text-cyan-400"></i>
                        Session Stats
                    </h2>
                    <button onclick="clearTranscript()"
                        class="text-xs text-gray-400 hover:text-red-400 transition-colors flex items-center gap-1">
                        <i class="fa-solid fa-trash"></i> Clear
                    </button>
                </div>

                <div class="grid grid-cols-4 gap-4 text-center">
                    <div class="bg-gray-900/30 rounded-xl p-3 border border-gray-800">
                        <div class="text-2xl font-bold text-cyan-400" id="stat-duration">00:00</div>
                        <div class="text-xs text-gray-500 mt-1">Duration</div>
                    </div>
                    <div class="bg-gray-900/30 rounded-xl p-3 border border-gray-800">
                        <div class="text-2xl font-bold text-emerald-400" id="stat-chunks">0</div>
                        <div class="text-xs text-gray-500 mt-1">Audio Chunks</div>
                    </div>
                    <div class="bg-gray-900/30 rounded-xl p-3 border border-gray-800">
                        <div class="text-2xl font-bold text-purple-400" id="stat-lines">0</div>
                        <div class="text-xs text-gray-500 mt-1">Lines</div>
                    </div>
                    <div class="bg-gray-900/30 rounded-xl p-3 border border-gray-800">
                        <div class="text-2xl font-bold text-amber-400" id="stat-latency">0ms</div>
                        <div class="text-xs text-gray-500 mt-1">Latency</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transcription Area -->
        <div class="glass-panel rounded-2xl p-1 flex flex-col h-[calc(100vh-380px)] min-h-[400px]">
            <!-- Toolbar -->
            <div
                class="flex items-center justify-between px-4 py-3 border-b border-white/5 bg-gray-900/20 rounded-t-xl">
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        <button id="record-btn" onclick="toggleRecording()"
                            class="group relative flex items-center gap-2 px-6 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-full font-semibold transition-all shadow-lg shadow-red-500/20 hover:shadow-red-500/40 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="w-2 h-2 bg-white rounded-full group-[.recording]:hidden"></span>
                            <i class="fa-solid fa-microphone group-[.recording]:hidden"></i>
                            <i class="fa-solid fa-stop group-[.recording]:inline hidden"></i>
                            <span class="group-[.recording]:hidden">Start Recording</span>
                            <span class="group-[.recording]:inline hidden">Stop</span>
                        </button>

                        <div id="recording-indicator"
                            class="hidden items-center gap-2 px-3 py-1 rounded-full bg-red-500/10 border border-red-500/20 text-red-400 text-xs font-medium">
                            <div class="w-2 h-2 bg-red-500 rounded-full recording-indicator"></div>
                            REC
                        </div>
                    </div>

                    <div class="h-8 w-px bg-gray-700 mx-1"></div>

                    <div id="audio-visualizer" class="flex items-end gap-0.5 h-8 opacity-0 transition-opacity">
                        <div class="audio-bar bg-cyan-400 w-1 h-2 rounded-full"></div>
                        <div class="audio-bar bg-cyan-400 w-1 h-4 rounded-full"></div>
                        <div class="audio-bar bg-cyan-400 w-1 h-6 rounded-full"></div>
                        <div class="audio-bar bg-cyan-400 w-1 h-3 rounded-full"></div>
                        <div class="audio-bar bg-cyan-400 w-1 h-5 rounded-full"></div>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="saveTranscript()" class="p-2 text-gray-400 hover:text-cyan-400 transition-colors"
                        title="Save Transcript">
                        <i class="fa-solid fa-download"></i>
                    </button>
                    <button onclick="copyTranscript()" class="p-2 text-gray-400 hover:text-cyan-400 transition-colors"
                        title="Copy to Clipboard">
                        <i class="fa-regular fa-copy"></i>
                    </button>
                </div>
            </div>

            <!-- Transcript Content -->
            <div id="transcript-container"
                class="flex-1 overflow-y-auto p-6 space-y-3 font-mono text-sm leading-relaxed scroll-smooth">
                <div id="placeholder-text"
                    class="flex flex-col items-center justify-center h-full text-gray-500 space-y-4">
                    <div class="w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center">
                        <i class="fa-solid fa-microphone-lines text-2xl text-gray-600"></i>
                    </div>
                    <p>Press Start Recording to begin transcription</p>
                    <p class="text-xs text-gray-600">Supports 99+ languages • Real-time streaming • WebSocket</p>
                </div>
            </div>
        </div>

        <!-- Info Footer -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-xs text-gray-500">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-bolt text-yellow-500"></i>
                <span>Enterprise-grade accuracy with variable chunk handling</span>
            </div>
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-globe text-cyan-500"></i>
                <span>99 languages supported including Cantonese (yue)</span>
            </div>
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-shield-halved text-emerald-500"></i>
                <span>Optimized for background noise & telephony</span>
            </div>
        </div>
    </main>

    <script>
        // Global State
        let ws = null;
        let mediaRecorder = null;
        let audioStream = null;
        let isRecording = false;
        let startTime = null;
        let durationInterval = null;
        let chunkCount = 0;
        let lineCount = 0;
        let currentInterimId = null;

        // API Configuration
        const API_ENDPOINT = 'wss://api.cartesia.ai/stt/stream';

        // Stats Update
        function updateDuration() {
            if (!startTime) return;
            const diff = Math.floor((Date.now() - startTime) / 1000);
            const mins = Math.floor(diff / 60).toString().padStart(2, '0');
            const secs = (diff % 60).toString().padStart(2, '0');
            document.getElementById('stat-duration').textContent = `${mins}:${secs}`;
        }

        function updateStats() {
            document.getElementById('stat-chunks').textContent = chunkCount;
            document.getElementById('stat-lines').textContent = lineCount;
        }

        // Connection Status
        function setStatus(status, message) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');

            const colors = {
                connected: 'bg-emerald-500',
                connecting: 'bg-yellow-500 animate-pulse',
                disconnected: 'bg-gray-500',
                error: 'bg-red-500'
            };

            dot.className = `w-2 h-2 rounded-full ${colors[status] || colors.disconnected}`;
            text.textContent = message;
            text.className = status === 'error' ? 'text-red-400' : 'text-gray-400';
        }

        // WebSocket Connection
        async function connectWebSocket() {
            const apiKey = document.getElementById('api-key').value.trim();
            if (!apiKey) {
                alert('Please enter your Cartesia API Key');
                return false;
            }

            const model = document.getElementById('model-select').value;
            const language = document.getElementById('language-select').value;

            setStatus('connecting', 'Connecting...');

            try {
                // Construct WebSocket URL with query parameters for the handshake
                // Recommended path: /stt/websocket
                const wsUrl = new URL('wss://api.cartesia.ai/stt/websocket');
                wsUrl.searchParams.append('api_key', apiKey);
                wsUrl.searchParams.append('cartesia_version', '2024-06-10');
                wsUrl.searchParams.append('model', model);
                wsUrl.searchParams.append('language', language);
                wsUrl.searchParams.append('sample_rate', 16000);

                ws = new WebSocket(wsUrl.toString());

                ws.onopen = () => {
                    console.log("[Cartesia STT] Connection Open");
                    // 1. Tell handshake we are ready (though query params handled auth)
                    // Some versions might still require an auth message, but usually query params suffice for handshake

                    // 2. Resolve to tell startRecording it's safe to start MediaRecorder
                    setStatus('connected', 'Connected');
                    if (ws.resolveOpen) ws.resolveOpen(true);
                };

                ws.onmessage = (event) => {
                    handleTranscriptionMessage(JSON.parse(event.data));
                };

                ws.onerror = (error) => {
                    console.error('WebSocket Error:', error);
                    setStatus('error', 'Connection Failed');
                    stopRecording();
                };

                ws.onclose = () => {
                    setStatus('disconnected', 'Disconnected');
                    if (isRecording) stopRecording();
                };

                // Return promise that resolves when onopen finishes
                return new Promise((resolve) => {
                    ws.resolveOpen = resolve;
                });
            } catch (error) {
                console.error('Connection error:', error);
                setStatus('error', 'Connection Failed');
                return false;
            }
        }

        // Handle Incoming Transcriptions (Cartesia Protocol)
        function handleTranscriptionMessage(data) {
            // Remove placeholder
            const placeholder = document.getElementById('placeholder-text');
            if (placeholder) placeholder.remove();

            // Cartesia Ink STT Schema: { transcription: { text: "...", final: bool } }
            // Some versions might have data.type === 'transcription'
            const transcription = data.transcription || (data.type === 'transcription' ? data.transcription : null);
            if (!transcription) return;

            const text = transcription.text;
            const isFinal = transcription.final;

            if (!text) return;

            // Calculate latency if available
            if (data.received_at && data.sent_at) {
                const latency = Date.now() - new Date(data.sent_at).getTime();
                document.getElementById('stat-latency').textContent = `${latency}ms`;
            }

            const container = document.getElementById('transcript-container');

            if (!isFinal) {
                // Update interim transcript
                if (currentInterimId) {
                    const interimEl = document.getElementById(currentInterimId);
                    if (interimEl) {
                        interimEl.textContent = text;
                    }
                } else {
                    currentInterimId = `interim-${Date.now()}`;
                    const div = document.createElement('div');
                    div.id = currentInterimId;
                    div.className = 'transcript-line interim text-cyan-300 pl-4 transition-all duration-200';
                    div.textContent = text;
                    container.appendChild(div);
                    container.scrollTop = container.scrollHeight;
                }
            } else {
                // Convert interim to final or create new final
                if (currentInterimId) {
                    const interimEl = document.getElementById(currentInterimId);
                    if (interimEl) {
                        interimEl.textContent = text;
                        interimEl.className = 'transcript-line final text-gray-100 pl-4 border-l-emerald-500';
                        interimEl.id = `final-${Date.now()}`;
                        currentInterimId = null;
                    }
                } else {
                    const div = document.createElement('div');
                    div.className = 'transcript-line final text-gray-100 pl-4 border-l-emerald-500';
                    div.textContent = text;
                    container.appendChild(div);
                }
                lineCount++;
                updateStats();
                container.scrollTop = container.scrollHeight;
            }
        }

        // Recording Control
        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            const apiKey = document.getElementById('api-key').value.trim();
            if (!apiKey) {
                alert('Please enter your Cartesia API Key first');
                document.getElementById('api-key').focus();
                return;
            }

            // Connect WebSocket first
            const connected = await connectWebSocket();
            if (!connected) return;

            try {
                audioStream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        channelCount: 1,
                        sampleRate: 16000,
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                });

                // Setup MediaRecorder with timeslice for streaming
                const mimeType = MediaRecorder.isTypeSupported('audio/webm;codecs=opus')
                    ? 'audio/webm;codecs=opus'
                    : 'audio/webm';

                mediaRecorder = new MediaRecorder(audioStream, {
                    mimeType: mimeType,
                    audioBitsPerSecond: 128000
                });

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0 && ws && ws.readyState === WebSocket.OPEN) {
                        // Convert blob to array buffer and send
                        event.data.arrayBuffer().then(buffer => {
                            ws.send(buffer);
                            chunkCount++;
                            updateStats();
                        });
                    }
                };

                mediaRecorder.start(250); // Send chunks every 250ms

                isRecording = true;
                startTime = Date.now();
                durationInterval = setInterval(updateDuration, 1000);

                // UI Updates
                document.getElementById('record-btn').classList.add('recording');
                document.getElementById('recording-indicator').classList.remove('hidden');
                document.getElementById('recording-indicator').classList.add('flex');
                document.getElementById('audio-visualizer').classList.remove('opacity-0');

            } catch (error) {
                console.error('Microphone access error:', error);
                alert('Could not access microphone. Please ensure you have granted permission.');
                stopRecording();
            }
        }

        function stopRecording() {
            isRecording = false;

            // Stop MediaRecorder
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }

            // Stop audio tracks
            if (audioStream) {
                audioStream.getTracks().forEach(track => track.stop());
                audioStream = null;
            }

            // Close WebSocket
            if (ws) {
                ws.close();
                ws = null;
            }

            // Clear intervals
            if (durationInterval) {
                clearInterval(durationInterval);
                durationInterval = null;
            }

            // UI Updates
            document.getElementById('record-btn').classList.remove('recording');
            document.getElementById('recording-indicator').classList.add('hidden');
            document.getElementById('recording-indicator').classList.remove('flex');
            document.getElementById('audio-visualizer').classList.add('opacity-0');
            setStatus('disconnected', 'Disconnected');

            // Reset current interim
            currentInterimId = null;
        }

        // Utility Functions
        function clearTranscript() {
            const container = document.getElementById('transcript-container');
            container.innerHTML = `
                <div id="placeholder-text" class="flex flex-col items-center justify-center h-full text-gray-500 space-y-4">
                    <div class="w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center">
                        <i class="fa-solid fa-microphone-lines text-2xl text-gray-600"></i>
                    </div>
                    <p>Press Start Recording to begin transcription</p>
                    <p class="text-xs text-gray-600">Supports 99+ languages • Real-time streaming • WebSocket</p>
                </div>
            `;
            lineCount = 0;
            chunkCount = 0;
            document.getElementById('stat-lines').textContent = '0';
            document.getElementById('stat-chunks').textContent = '0';
            document.getElementById('stat-duration').textContent = '00:00';
            startTime = null;
        }

        function getTranscriptText() {
            const lines = document.querySelectorAll('.transcript-line.final');
            return Array.from(lines).map(line => line.textContent).join('\n');
        }

        function copyTranscript() {
            const text = getTranscriptText();
            if (!text) return;
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard');
            });
        }

        function saveTranscript() {
            const text = getTranscriptText();
            if (!text) return;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transcript-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg border border-gray-700 text-sm font-medium z-50 animate-slide-up';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(20px)';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Load saved API key
        window.addEventListener('load', () => {
            const savedKey = localStorage.getItem('cartesia_api_key');
            if (savedKey) {
                document.getElementById('api-key').value = savedKey;
            }
        });

        // Save API key on input
        document.getElementById('api-key').addEventListener('change', (e) => {
            localStorage.setItem('cartesia_api_key', e.target.value);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                toggleRecording();
            }
        });
    </script>
</body>

</html>